# DLTS Enhanced Networked Monographs: Search

> Vue.js/D3 search SPA for the DLTS Enhanced Networked Monographs website.

## Build Setup

``` bash
# Install dependencies including devDependencies
# If NODE_ENV is not set to production, can leave out --production=false
yarn install --production=false

# Serve with hot reload at localhost:8080
npm run dev

# Build for production with minification
npm run build

# Build for production and view the bundle analyzer report
npm run build --report

# Run unit tests
npm run test:unit

# Run Selenium tests against localhost ENM
npm run test:browser:local

# Debugging Selenium tests in Chrome only
# Timeout is set to very hight value to allow for pausing at breakpoints
npm run test:browser:local:debug:chrome

# Debugging Selenium tests in Firefox only
# Timeout is set to very hight value to allow for pausing at breakpoints
npm run test:browser:local:debug:firefox

# Update golden files for Selenium tests
UPDATE_GOLDEN_FILES=1 npm run test:browser:local

# Run all tests
npm test
```

For a detailed explanation on how things work, check out the [guide](http://vuejs-templates.github.io/webpack/) and [docs for vue-loader](http://vuejs.github.io/vue-loader).

## Tests

### Unit tests

Currently there are no unit tests besides the HelloWorld Jest test that was
automatically generated by the Vue Webpack template.

### Solr: using the live servers, not fakes

Currently Solr is not stubbed out for the tests.  ENM data will be frozen so in
theory there should be no data volatility when using the live Solr instances.
Also, the live Solr indexes are tested using the [ENM Verifier](https://github.com/nyulibraries/dlts-enm-verifier).
Nevertheless, in principle the Solr dependency should be replaced with a fake.
This might be done in the future by adding a `testmode` query parameter that when
set to true shifts the application to a fake Solr running on a pre-defined host and port.

If it is decided that the tests will only run against a local build (that is the
case now, but it wouldn't be hard to make conf files for dev, stage, and prod),
then another option would be to have a test build that has the fake Solr responses
baked into the application.  This would eliminate the need for a fake Solr server
running as a separate backend process.  This build would be quite large however
as some of the Solr responses have a lot of data in them.

### Golden files

The initial golden files were created by scripts which ran queries against the
verified Solr indexes and used the responses to create the JSON golden files.
In the future, if the Solr indexes change, once they pass validation the golden
files can be updated by re-running all tests with an environment variable
`UPDATE_GOLDEN_FILES` set to `1`.  The new golden files should then be checked
into the repo.

Note that there may be some tests that do not verify against golden files but
have check data directly hardcoded into the scripts.  These will need to be updated
manually if they are broken by the Solr index changes. 
